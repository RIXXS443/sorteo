<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Registro de Sorteo</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }

    h1 {
      text-align: center;
    }

    .sorteo-info, .form-group {
      margin-bottom: 20px;
      text-align: center;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }

    th, td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }

    input[type="text"] {
      padding: 5px;
      width: 200px;
      margin-right: 10px;
    }

    .number-selection {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
      margin-bottom: 20px;
    }

    .number-selection label {
      display: inline-block;
      margin: 5px;
    }

    button {
      padding: 5px 10px;
      cursor: pointer;
    }

    button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <h1>Registro de Sorteo</h1>

  <div class="container">
    <div class="sorteo-info">
      <label for="sorteo-name">Nombre del Sorteo:</label>
      <input type="text" id="sorteo-name" required>
    </div>

    <div class="number-selection">
<label><input type="checkbox" value="1"> 1</label>
    <label><input type="checkbox" value="2"> 2</label>
    <label><input type="checkbox" value="3"> 3</label>
    <label><input type="checkbox" value="4"> 4</label>
    <label><input type="checkbox" value="5"> 5</label>
    <label><input type="checkbox" value="6"> 6</label>
    <label><input type="checkbox" value="7"> 7</label>
    <label><input type="checkbox" value="8"> 8</label>
    <label><input type="checkbox" value="9"> 9</label>
    <label><input type="checkbox" value="10"> 10</label>
    <label><input type="checkbox" value="11"> 11</label>
    <label><input type="checkbox" value="12"> 12</label>
    <label><input type="checkbox" value="13"> 13</label>
    <label><input type="checkbox" value="14"> 14</label>
    <label><input type="checkbox" value="15"> 15</label>
    <label><input type="checkbox" value="16"> 16</label>
    <label><input type="checkbox" value="17"> 17</label>
    <label><input type="checkbox" value="18"> 18</label>
    <label><input type="checkbox" value="19"> 19</label>
    <label><input type="checkbox" value="20"> 20</label>
    <label><input type="checkbox" value="21"> 21</label>
    <label><input type="checkbox" value="22"> 22</label>
    <label><input type="checkbox" value="23"> 23</label>
    <label><input type="checkbox" value="24"> 24</label>
    <label><input type="checkbox" value="25"> 25</label>
    <label><input type="checkbox" value="26"> 26</label>
    <label><input type="checkbox" value="27"> 27</label>
    <label><input type="checkbox" value="28"> 28</label>
    <label><input type="checkbox" value="29"> 29</label>
    <label><input type="checkbox" value="30"> 30</label>
    <label><input type="checkbox" value="31"> 31</label>
    <label><input type="checkbox" value="32"> 32</label>
    <label><input type="checkbox" value="33"> 33</label>
    <label><input type="checkbox" value="34"> 34</label>
    <label><input type="checkbox" value="35"> 35</label>
    <label><input type="checkbox" value="36"> 36</label>
    <label><input type="checkbox" value="37"> 37</label>
    <label><input type="checkbox" value="38"> 38</label>
    <label><input type="checkbox" value="39"> 39</label>
    <label><input type="checkbox" value="40"> 40</label>
    <label><input type="checkbox" value="41"> 41</label>
    <label><input type="checkbox" value="42"> 42</label>
    <label><input type="checkbox" value="43"> 43</label>
    <label><input type="checkbox" value="44"> 44</label>
    <label><input type="checkbox" value="45"> 45</label>
    <label><input type="checkbox" value="46"> 46</label>
    <label><input type="checkbox" value="47"> 47</label>
    <label><input type="checkbox" value="48"> 48</label>
    <label><input type="checkbox" value="49"> 49</label>
    <label><input type="checkbox" value="50"> 50</label>
	<label><input type="checkbox" value="50"> 50</label>
    <label><input type="checkbox" value="51"> 51</label>
    <label><input type="checkbox" value="52"> 52</label>
    <label><input type="checkbox" value="53"> 53</label>
    <label><input type="checkbox" value="54"> 54</label>
    <label><input type="checkbox" value="55"> 55</label>
    <label><input type="checkbox" value="56"> 56</label>
    <label><input type="checkbox" value="57"> 57</label>
    <label><input type="checkbox" value="58"> 58</label>
    <label><input type="checkbox" value="59"> 59</label>
    <label><input type="checkbox" value="60"> 60</label>
    <label><input type="checkbox" value="61"> 61</label>
    <label><input type="checkbox" value="62"> 62</label>
    <label><input type="checkbox" value="63"> 63</label>
    <label><input type="checkbox" value="64"> 64</label>
    <label><input type="checkbox" value="65"> 65</label>
    <label><input type="checkbox" value="66"> 66</label>
    <label><input type="checkbox" value="67"> 67</label>
    <label><input type="checkbox" value="68"> 68</label>
    <label><input type="checkbox" value="69"> 69</label>
    <label><input type="checkbox" value="70"> 70</label>
    <label><input type="checkbox" value="71"> 71</label>
    <label><input type="checkbox" value="72"> 72</label>
    <label><input type="checkbox" value="73"> 73</label>
    <label><input type="checkbox" value="74"> 74</label>
    <label><input type="checkbox" value="75"> 75</label>
    <label><input type="checkbox" value="76"> 76</label>
    <label><input type="checkbox" value="77"> 77</label>
    <label><input type="checkbox" value="78"> 78</label>
    <label><input type="checkbox" value="79"> 79</label>
    <label><input type="checkbox" value="80"> 80</label>
    <label><input type="checkbox" value="81"> 81</label>
    <label><input type="checkbox" value="82"> 82</label>
    <label><input type="checkbox" value="83"> 83</label>
    <label><input type="checkbox" value="84"> 84</label>
    <label><input type="checkbox" value="85"> 85</label>
    <label><input type="checkbox" value="86"> 86</label>
    <label><input type="checkbox" value="87"> 87</label>
    <label><input type="checkbox" value="88"> 88</label>
    <label><input type="checkbox" value="89"> 89</label>
    <label><input type="checkbox" value="90"> 90</label>
    <label><input type="checkbox" value="91"> 91</label>
    <label><input type="checkbox" value="92"> 92</label>
    <label><input type="checkbox" value="93"> 93</label>
    <label><input type="checkbox" value="94"> 94</label>
    <label><input type="checkbox" value="95"> 95</label>
    <label><input type="checkbox" value="96"> 96</label>
    <label><input type="checkbox" value="97"> 97</label>
    <label><input type="checkbox" value="98"> 98</label>
    <label><input type="checkbox" value="99"> 99</label>
    <label><input type="checkbox" value="100"> 100</label>
    <label><input type="checkbox" value="101"> 101</label>
    <label><input type="checkbox" value="102"> 102</label>
    <label><input type="checkbox" value="103"> 103</label>
    <label><input type="checkbox" value="104"> 104</label>
    <label><input type="checkbox" value="105"> 105</label>
    <label><input type="checkbox" value="106"> 106</label>
    <label><input type="checkbox" value="107"> 107</label>
    <label><input type="checkbox" value="108"> 108</label>
    <label><input type="checkbox" value="109"> 109</label>
    <label><input type="checkbox" value="110"> 110</label>
    <label><input type="checkbox" value="111"> 111</label>
    <label><input type="checkbox" value="112"> 112</label>
    <label><input type="checkbox" value="113"> 113</label>
    <label><input type="checkbox" value="114"> 114</label>
    <label><input type="checkbox" value="115"> 115</label>
    <label><input type="checkbox" value="116"> 116</label>
    <label><input type="checkbox" value="117"> 117</label>
    <label><input type="checkbox" value="118"> 118</label>
    <label><input type="checkbox" value="119"> 119</label>
    <label><input type="checkbox" value="120"> 120</label>
    <label><input type="checkbox" value="121"> 121</label>
    <label><input type="checkbox" value="122"> 122</label>
    <label><input type="checkbox" value="123"> 123</label>
    <label><input type="checkbox" value="124"> 124</label>
    <label><input type="checkbox" value="125"> 125</label>
    <label><input type="checkbox" value="126"> 126</label>
    <label><input type="checkbox" value="127"> 127</label>
    <label><input type="checkbox" value="128"> 128</label>
    <label><input type="checkbox" value="129"> 129</label>
    <label><input type="checkbox" value="130"> 130</label>
    <label><input type="checkbox" value="131"> 131</label>
    <label><input type="checkbox" value="132"> 132</label>
    <label><input type="checkbox" value="133"> 133</label>
    <label><input type="checkbox" value="134"> 134</label>
    <label><input type="checkbox" value="135"> 135</label>
    <label><input type="checkbox" value="136"> 136</label>
    <label><input type="checkbox" value="137"> 137</label>
    <label><input type="checkbox" value="138"> 138</label>
    <label><input type="checkbox" value="139"> 139</label>
    <label><input type="checkbox" value="140"> 140</label>
    <label><input type="checkbox" value="141"> 141</label>
    <label><input type="checkbox" value="142"> 142</label>
    <label><input type="checkbox" value="143"> 143</label>
    <label><input type="checkbox" value="144"> 144</label>
    <label><input type="checkbox" value="145"> 145</label>
    <label><input type="checkbox" value="146"> 146</label>
    <label><input type="checkbox" value="147"> 147</label>
    <label><input type="checkbox" value="148"> 148</label>
    <label><input type="checkbox" value="149"> 149</label>
    <label><input type="checkbox" value="150"> 150</label>
    </div>

    <table id="sorteo-table">
      <thead>
        <tr>
          <th>Número</th>
          <th>Nombre</th>
          <th>Sorteo</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="form-group">
      <label for="participant-name">Nombre del Participante:</label>
      <input type="text" id="participant-name" required>
      <button id="add-participant">Agregar Participante</button>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const sorteoNameInput = document.getElementById('sorteo-name');
      const addParticipantButton = document.getElementById('add-participant');
      const sorteoTableBody = document.querySelector('#sorteo-table tbody');
      const participantNameInput = document.getElementById('participant-name');
      const numberCheckboxes = document.querySelectorAll('.number-selection input[type="checkbox"]');

      // Almacenar números ya registrados
      const numerosRegistrados = new Set();

      // Obtener números registrados al cargar la página
      obtenerNumerosRegistrados();

      addParticipantButton.addEventListener('click', function () {
        const sorteoName = sorteoNameInput.value.trim();
        const participantName = participantNameInput.value.trim();
        
        const selectedNumbers = Array.from(numberCheckboxes)
          .filter(checkbox => checkbox.checked)
          .map(checkbox => checkbox.value);

        // Validaciones
        if (!sorteoName || selectedNumbers.length === 0 || !participantName) {
          alert("Por favor, completa todos los campos y selecciona al menos un número.");
          return;
        }

        // Verificar duplicados
        const duplicados = selectedNumbers.filter(num => numerosRegistrados.has(num));
        if (duplicados.length > 0) {
          alert(`Los números ya están registrados: ${duplicados.join(', ')}`);
          return;
        }

        // Agregar participante y números al sorteo
        selectedNumbers.forEach(function (number) {
          const row = document.createElement('tr');
          const numberCell = document.createElement('td');
          const nameCell = document.createElement('td');
          const sorteoCell = document.createElement('td');

          numberCell.textContent = number;
          nameCell.textContent = participantName;
          sorteoCell.textContent = sorteoName;

          row.appendChild(numberCell);
          row.appendChild(nameCell);
          row.appendChild(sorteoCell);
          sorteoTableBody.appendChild(row);

          // Guardar el número en el conjunto para evitar duplicados
          numerosRegistrados.add(number);

          // Llamada al API para guardar en la base de datos
          guardarParticipanteEnBaseDeDatos(sorteoName, number, participantName);
        });

        // Limpiar los campos de entrada
        participantNameInput.value = '';
        numberCheckboxes.forEach(checkbox => checkbox.checked = false);
      });

      function guardarParticipanteEnBaseDeDatos(sorteo, numero, nombre) {
        const url = 'https://prod-02.brazilsouth.logic.azure.com/workflows/e0216dc0080c434f92f90ffda79fd4ff/triggers/manual/paths/invoke/crear_participante?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=lWqG4wSkg3jW3VK7Sl-5oRVdUsijaLZ3BzovP6e86ZA';

        const data = {
          Numero: numero.toString(),
          Nombre: nombre,
          Sorteo: sorteo
        };

        fetch(url, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(data => {
          console.log('Participante guardado:', data);
        })
        .catch(error => {
          console.error('Error al guardar participante:', error);
        });
      }

      function obtenerNumerosRegistrados() {
        const url = 'https://prod-21.brazilsouth.logic.azure.com/workflows/a1f66a512b30401f837963fb67c270fb/triggers/manual/paths/invoke/obtener_registros?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=wv5unUjOMZBO6-uen9yvRsJi-ao7WAkE_pB35q_0D7k';

        fetch(url, {
          method: 'GET'
        })
        .then(response => response.json())
        .then(data => {
          console.log('Registros obtenidos:', data);
          data.forEach(registro => {
            const row = document.createElement('tr');
            const numberCell = document.createElement('td');
            const nameCell = document.createElement('td');
            const sorteoCell = document.createElement('td');

            numberCell.textContent = registro.Numero;
            nameCell.textContent = registro["Nombre y Apellido"];
            sorteoCell.textContent = registro.Sorteo;

            row.appendChild(numberCell);
            row.appendChild(nameCell);
            row.appendChild(sorteoCell);
            sorteoTableBody.appendChild(row);

            // Marcar los checkboxes correspondientes a los números registrados
            numberCheckboxes.forEach(checkbox => {
              if (checkbox.value === registro.Numero) {
                checkbox.checked = true;
                // Agregar el número a los registrados
                numerosRegistrados.add(registro.Numero);
              }
            });
          });
        })
        .catch(error => {
          console.error('Error al obtener registros:', error);
        });
      }
    });
  </script>
</body>
</html>
