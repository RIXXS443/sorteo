<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Registro de Sorteo</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }

    h1 {
      text-align: center;
    }

    .sorteo-info, .form-group {
      margin-bottom: 20px;
      text-align: center;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }

    th, td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }

    input[type="text"] {
      padding: 5px;
      width: 200px;
      margin-right: 10px;
    }

    button {
      padding: 5px 10px;
      cursor: pointer;
    }

    button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }

  </style>
</head>
<body>
  <h1>Registro de Sorteo</h1>

  <div class="container">
    <div class="sorteo-info">
      <label for="sorteo-name">Nombre del Sorteo:</label>
      <input type="text" id="sorteo-name" required>

      <label for="sorteo-numbers">Números del Sorteo (separados por comas):</label>
      <input type="text" id="sorteo-numbers" required>
    </div>

    <table id="sorteo-table">
      <thead>
        <tr>
          <th>Número</th>
          <th>Nombre</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="form-group">
      <label for="participant-name">Nombre del Participante:</label>
      <input type="text" id="participant-name" required>
      <button id="add-participant">Agregar Participante</button>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const sorteoNameInput = document.getElementById('sorteo-name');
      const sorteoNumbersInput = document.getElementById('sorteo-numbers');
      const addParticipantButton = document.getElementById('add-participant');
      const sorteoTableBody = document.querySelector('#sorteo-table tbody');
      const participantNameInput = document.getElementById('participant-name');

      addParticipantButton.addEventListener('click', function () {
        const sorteoName = sorteoNameInput.value.trim();
        const sorteoNumbersString = sorteoNumbersInput.value.trim();
        const participantName = participantNameInput.value.trim();

        // Validaciones
        if (!sorteoName || !sorteoNumbersString || !participantName) {
          alert("Por favor, completa todos los campos.");
          return;
        }

        const sorteoNumbers = sorteoNumbersString.split(',')
          .map(num => num.trim())
          .filter(num => !isNaN(num) && num !== '')
          .map(Number);

        if (sorteoNumbers.length === 0) {
          alert("Introduce números válidos separados por comas.");
          return;
        }

        // Agregar participante y números al sorteo
        sorteoNumbers.forEach(function (number) {
          const row = document.createElement('tr');
          const numberCell = document.createElement('td');
          const nameCell = document.createElement('td');

          numberCell.textContent = number;
          nameCell.textContent = participantName;

          row.appendChild(numberCell);
          row.appendChild(nameCell);
          sorteoTableBody.appendChild(row);

          // Llamada al API para guardar en la base de datos
          guardarParticipanteEnBaseDeDatos(sorteoName, number, participantName);
        });

        // Limpiar los campos de entrada
        participantNameInput.value = '';
      });

      // Desactivar botón si faltan datos
      document.querySelectorAll('input').forEach(input => {
        input.addEventListener('input', () => {
          addParticipantButton.disabled = !sorteoNameInput.value.trim() || !sorteoNumbersInput.value.trim() || !participantNameInput.value.trim();
        });
      });

      function guardarParticipanteEnBaseDeDatos(sorteo, numero, nombre) {
        const url = 'https://prod-02.brazilsouth.logic.azure.com/workflows/e0216dc0080c434f92f90ffda79fd4ff/triggers/manual/paths/invoke/crear_participante?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=lWqG4wSkg3jW3VK7Sl-5oRVdUsijaLZ3BzovP6e86ZA';

        const data = {
          Numero: numero.toString(),
          Nombre: nombre,
          Sorteo: sorteo
        };

        fetch(url, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(data => {
          console.log('Participante guardado:', data);
        })
        .catch(error => {
          console.error('Error al guardar participante:', error);
        });
      }
    });
  </script>
</body>
</html>
